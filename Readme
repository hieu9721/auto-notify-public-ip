# ğŸŒ IP Monitor Bot

Bot theo dÃµi Ä‘á»‹a chá»‰ IP public vÃ  gá»­i thÃ´ng bÃ¡o tá»± Ä‘á»™ng khi cÃ³ thay Ä‘á»•i. Há»— trá»£ thÃ´ng bÃ¡o qua Email, Telegram vÃ  Discord.

## âœ¨ TÃ­nh nÄƒng

- ğŸ”„ **Theo dÃµi IP liÃªn tá»¥c** vá»›i khoáº£ng thá»i gian tÃ¹y chá»‰nh
- ğŸ“§ **ThÃ´ng bÃ¡o Ä‘a kÃªnh**: Email, Telegram, Discord
- ğŸ“ **Ghi log chi tiáº¿t** vá»›i timestamp
- ğŸ”„ **KhÃ´i phá»¥c tá»± Ä‘á»™ng** khi gáº·p lá»—i
- âš™ï¸ **Cháº¡y nhÆ° systemd service** hoáº·c thá»§ cÃ´ng
- ğŸ›¡ï¸ **Backup multiple IP services** Ä‘á»ƒ Ä‘áº£m báº£o Ä‘á»™ tin cáº­y
- ğŸ¯ **Lightweight** - chá»‰ cáº§n 1 dependency duy nháº¥t

## ğŸ“‹ YÃªu cáº§u há»‡ thá»‘ng

- **Python 3.6+**
- **Linux** (Ubuntu, CentOS, Debian, Arch, etc.)
- **Internet connection**
- **pip3** hoáº·c **python3-pip**

## ğŸš€ CÃ i Ä‘áº·t nhanh

### 1. Clone hoáº·c táº£i project
```bash
mkdir ~/ip-monitor-bot
cd ~/ip-monitor-bot
```

### 2. Táº¡o cÃ¡c file chÃ­nh
Táº¡o file `main.py` vá»›i code tá»« repository nÃ y.

### 3. CÃ i Ä‘áº·t dependencies
```bash
pip3 install requests python-dotenv
```

### 4. Cáº¥u hÃ¬nh environment variables
```bash
# Sao chÃ©p file env máº«u
cp .env.example .env

# Chá»‰nh sá»­a file .env vá»›i thÃ´ng tin cá»§a báº¡n
nano .env
```

### 5. Kiá»ƒm tra hoáº¡t Ä‘á»™ng
```bash
python3 main.py --check-ip
```

## âš™ï¸ Cáº¥u hÃ¬nh chi tiáº¿t

### ğŸŒ Environment Variables (Khuyáº¿n nghá»‹)

Bot há»— trá»£ cáº¥u hÃ¬nh qua **environment variables** Ä‘á»ƒ báº£o máº­t tá»‘t hÆ¡n. Táº¡o file `.env`:

```bash
# Sao chÃ©p file máº«u
cp .env.example .env
```

**VÃ­ dá»¥ file `.env`:**
```bash
# CÃ i Ä‘áº·t chung
CHECK_INTERVAL=300
NOTIFICATION_METHODS=email,telegram,discord

# Email
EMAIL_SENDER=your-email@gmail.com
EMAIL_PASSWORD=your-app-password
EMAIL_RECIPIENT=recipient@gmail.com

# Telegram - Gá»­i Ä‘áº¿n nhiá»u chat cÃ¹ng lÃºc
TELEGRAM_BOT_TOKEN=123456789:ABCDEF...
TELEGRAM_CHAT_IDS=123456789,987654321,-1001234567890

# Discord - Gá»­i Ä‘áº¿n nhiá»u webhook cÃ¹ng lÃºc  
DISCORD_WEBHOOK_URLS=https://discord.com/api/webhooks/111/AAA,https://discord.com/api/webhooks/222/BBB
```

### ğŸ“§ Cáº¥u hÃ¬nh Email (Gmail)

1. **Báº­t xÃ¡c thá»±c 2 bÆ°á»›c** cho Gmail
2. **Táº¡o App Password**:
   - VÃ o [Google Account Settings](https://myaccount.google.com/)
   - Security â†’ 2-Step Verification â†’ App passwords
   - Táº¡o password cho "Mail"
3. **ThÃªm vÃ o `.env`**:
```bash
EMAIL_SENDER=your-email@gmail.com
EMAIL_PASSWORD=app-password-16-chars
EMAIL_RECIPIENT=recipient@gmail.com
```

### ğŸ“± Cáº¥u hÃ¬nh Telegram (Multiple Chat IDs)

1. **Táº¡o bot**:
   - Nháº¯n tin vá»›i [@BotFather](https://t.me/botfather)
   - Gá»­i `/newbot` vÃ  lÃ m theo hÆ°á»›ng dáº«n
   - LÆ°u **bot token**

2. **Láº¥y Chat IDs**:
   ```bash
   # Nháº¯n tin vá»›i bot, sau Ä‘Ã³ truy cáº­p URL nÃ y:
   curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates"
   
   # TÃ¬m "chat":{"id": YOUR_CHAT_ID} trong response
   ```

3. **Cáº¥u hÃ¬nh nhiá»u chat IDs**:
```bash
TELEGRAM_BOT_TOKEN=123456789:ABCDEF...
# Gá»­i Ä‘áº¿n nhiá»u chat/group cÃ¹ng lÃºc (cÃ¡ch nhau bá»Ÿi dáº¥u pháº©y)
TELEGRAM_CHAT_IDS=123456789,987654321,-1001234567890
```

### ğŸ’¬ Cáº¥u hÃ¬nh Discord (Multiple Webhooks)

1. **Táº¡o webhooks**:
   - VÃ o Discord server â†’ Server Settings
   - Integrations â†’ Webhooks â†’ New Webhook
   - Copy webhook URL cho tá»«ng server/channel

2. **Cáº¥u hÃ¬nh nhiá»u webhooks**:
```bash
# Gá»­i Ä‘áº¿n nhiá»u Discord server/channel cÃ¹ng lÃºc
DISCORD_WEBHOOK_URLS=https://discord.com/api/webhooks/111/AAA,https://discord.com/api/webhooks/222/BBB
```

### ğŸ”„ Cáº¥u hÃ¬nh JSON (TÃ¹y chá»n)

Náº¿u khÃ´ng muá»‘n dÃ¹ng `.env`, báº¡n cÃ³ thá»ƒ dÃ¹ng `config.json`:

```json
{
  "notification_methods": ["telegram", "discord"],
  "telegram": {
    "bot_token": "123456789:ABCDEF...",
    "chat_ids": ["123456789", "987654321", "-1001234567890"]
  },
  "discord": {
    "webhook_urls": [
      "https://discord.com/api/webhooks/111/AAA",
      "https://discord.com/api/webhooks/222/BBB"
    ]
  }
}
```### âš¡ Cáº¥u hÃ¬nh Ä‘a kÃªnh
```bash
# Gá»­i thÃ´ng bÃ¡o Ä‘áº¿n táº¥t cáº£ cÃ¡c kÃªnh
NOTIFICATION_METHODS=email,telegram,discord

# Hoáº·c chá»‰ má»™t sá»‘ kÃªnh
NOTIFICATION_METHODS=telegram,discord
```

## ğŸ”§ CÃ¡ch sá»­ dá»¥ng

### Cháº¡y thá»§ cÃ´ng
```bash
# Kiá»ƒm tra IP hiá»‡n táº¡i
python3 main.py --check-ip

# Cháº¡y bot (Ctrl+C Ä‘á»ƒ dá»«ng)
python3 main.py

# Cháº¡y vá»›i file config tÃ¹y chá»‰nh
python3 main.py --config my_config.json
```

### Cháº¡y nhÆ° systemd service

1. **Táº¡o service file**:
```bash
sudo tee /etc/systemd/system/ip-monitor.service > /dev/null << EOF
[Unit]
Description=IP Monitor Bot
After=network.target

[Service]
Type=simple
User=$USER
WorkingDirectory=$HOME/ip-monitor-bot
ExecStart=/usr/bin/python3 $HOME/ip-monitor-bot/main.py
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF
```

2. **Khá»Ÿi Ä‘á»™ng service**:
```bash
# Reload systemd
sudo systemctl daemon-reload

# Enable vÃ  start service
sudo systemctl enable ip-monitor
sudo systemctl start ip-monitor

# Kiá»ƒm tra tráº¡ng thÃ¡i
sudo systemctl status ip-monitor

# Xem logs
sudo journalctl -u ip-monitor -f
```

3. **Quáº£n lÃ½ service**:
```bash
# Dá»«ng
sudo systemctl stop ip-monitor

# Khá»Ÿi Ä‘á»™ng láº¡i
sudo systemctl restart ip-monitor

# VÃ´ hiá»‡u hÃ³a
sudo systemctl disable ip-monitor
```

## ğŸ³ Cháº¡y vá»›i Docker

### Docker Compose (Khuyáº¿n nghá»‹)

1. **Táº¡o file docker-compose.yml**:
```yaml
version: '3.8'

services:
  ip-monitor:
    build: .
    container_name: ip-monitor-bot
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    environment:
      - CONFIG_FILE=/app/data/config.json
```

2. **Cháº¡y vá»›i Docker Compose**:
```bash
# Build vÃ  start
docker-compose up -d

# Xem logs
docker-compose logs -f

# Dá»«ng
docker-compose down

# Rebuild
docker-compose up -d --build
```

### Docker thÃ´ng thÆ°á»ng

```bash
# Build image
docker build -t ip-monitor-bot .

# Cháº¡y container
docker run -d \
  --name ip-monitor \
  --restart unless-stopped \
  --env-file .env \
  -v $(pwd)/data:/app/data \
  -v $(pwd)/logs:/app/logs \
  ip-monitor-bot

# Xem logs
docker logs -f ip-monitor

# Dá»«ng container
docker stop ip-monitor && docker rm ip-monitor
```

## ğŸ“ Xem logs

### Log file
```bash
# Xem log real-time
tail -f ~/ip-monitor-bot/main.log

# Xem log cuá»‘i
tail -20 ~/ip-monitor-bot/main.log
```

### System journal (náº¿u cháº¡y nhÆ° service)
```bash
# Xem log real-time
sudo journalctl -u ip-monitor -f

# Xem log hÃ´m nay
sudo journalctl -u ip-monitor --since today

# Xem log 1 giá» qua
sudo journalctl -u ip-monitor --since "1 hour ago"
```

### Docker logs
```bash
# Docker Compose
docker-compose logs -f

# Docker thÃ´ng thÆ°á»ng
docker logs -f ip-monitor
```

## ğŸ› ï¸ TÃ¹y chá»‰nh nÃ¢ng cao

### Environment Variables Ä‘áº§y Ä‘á»§

```bash
# File .env vá»›i táº¥t cáº£ tÃ¹y chá»n

# =============================================================================
# GENERAL SETTINGS
# =============================================================================
CHECK_INTERVAL=300
NOTIFICATION_METHODS=email,telegram,discord
LOG_LEVEL=INFO

# =============================================================================
# EMAIL CONFIGURATION
# =============================================================================
EMAIL_SMTP_SERVER=smtp.gmail.com
EMAIL_SMTP_PORT=587
EMAIL_SENDER=your-email@gmail.com
EMAIL_PASSWORD=your-app-password
EMAIL_RECIPIENT=recipient@gmail.com

# =============================================================================
# TELEGRAM CONFIGURATION (Multiple Chat Support)
# =============================================================================
TELEGRAM_BOT_TOKEN=123456789:ABCDEF...
# Gá»­i Ä‘áº¿n nhiá»u chat/group cÃ¹ng lÃºc
TELEGRAM_CHAT_IDS=123456789,987654321,-1001234567890
# Hoáº·c chá»‰ má»™t chat (tÆ°Æ¡ng thÃ­ch ngÆ°á»£c)
TELEGRAM_CHAT_ID=123456789

# =============================================================================
# DISCORD CONFIGURATION (Multiple Webhook Support)
# =============================================================================
# Gá»­i Ä‘áº¿n nhiá»u server/channel cÃ¹ng lÃºc
DISCORD_WEBHOOK_URLS=https://discord.com/api/webhooks/111/AAA,https://discord.com/api/webhooks/222/BBB
# Hoáº·c chá»‰ má»™t webhook (tÆ°Æ¡ng thÃ­ch ngÆ°á»£c)
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/111/AAA
```

### Script quáº£n lÃ½ tiá»‡n Ã­ch

Táº¡o script `manage.sh`:
```bash
#!/bin/bash

case "$1" in
    start)
        python3 main.py &
        echo "Bot started in background"
        ;;
    stop)
        pkill -f main.py
        echo "Bot stopped"
        ;;
    status)
        if pgrep -f main.py > /dev/null; then
            echo "Bot is running"
        else
            echo "Bot is not running"
        fi
        ;;
    ip)
        python3 main.py --check-ip
        ;;
    log)
        tail -f main.log
        ;;
    test-telegram)
        echo "Testing Telegram notifications..."
        # Test vá»›i IP giáº£
        ;;
    test-discord)
        echo "Testing Discord notifications..."
        # Test vá»›i IP giáº£
        ;;
    *)
        echo "Usage: $0 {start|stop|status|ip|log|test-telegram|test-discord}"
        ;;
esac
```

```bash
chmod +x manage.sh
./manage.sh start   # Khá»Ÿi Ä‘á»™ng
./manage.sh status  # Kiá»ƒm tra tráº¡ng thÃ¡i
./manage.sh ip      # Xem IP hiá»‡n táº¡i
./manage.sh log     # Xem log
./manage.sh stop    # Dá»«ng
```

## ğŸ› Troubleshooting

### Lá»—i thÆ°á»ng gáº·p

**1. "python-dotenv module not found"**
```bash
pip3 install python-dotenv
# hoáº·c
python3 -m pip install python-dotenv --user
```

**2. "Cannot load .env file"**
```bash
# Kiá»ƒm tra file .env cÃ³ tá»“n táº¡i
ls -la .env

# Kiá»ƒm tra quyá»n file
chmod 644 .env
```

**3. "Multiple Telegram chat IDs not working"**
```bash
# Kiá»ƒm tra format trong .env
TELEGRAM_CHAT_IDS=123456789,987654321,-1001234567890

# Äáº£m báº£o khÃ´ng cÃ³ khoáº£ng tráº¯ng
# ÄÃšNG: 123,456,789
# SAI:   123, 456, 789
```

**4. "Discord webhook failed"**
```bash
# Test webhook thá»§ cÃ´ng
curl -H "Content-Type: application/json" \
     -d '{"content":"Test message"}' \
     "https://discord.com/api/webhooks/YOUR_WEBHOOK_URL"
```

**5. Environment variables khÃ´ng Ä‘Æ°á»£c Ä‘á»c**
```bash
# Kiá»ƒm tra file .env
cat .env

# Kiá»ƒm tra python-dotenv
python3 -c "from dotenv import load_dotenv; load_dotenv(); import os; print(os.getenv('TELEGRAM_BOT_TOKEN'))"
```

### Debug mode

ThÃªm vÃ o `.env`:
```bash
LOG_LEVEL=DEBUG
```

Hoáº·c cháº¡y vá»›i debug:
```bash
python3 -c "
import logging
logging.basicConfig(level=logging.DEBUG)
exec(open('main.py').read())
"
```

### Test tá»«ng thÃ nh pháº§n

```bash
# Test láº¥y IP
python3 -c "
from main import IPMonitor
monitor = IPMonitor()
print('IP:', monitor.get_public_ip())
"

# Test Telegram
python3 -c "
from main import IPMonitor
monitor = IPMonitor()
monitor.send_telegram_notification('1.1.1.1', '2.2.2.2')
"

# Test Discord
python3 -c "
from main import IPMonitor
monitor = IPMonitor()
monitor.send_discord_notification('1.1.1.1', '2.2.2.2')
"
```

## ğŸ“Š GiÃ¡m sÃ¡t vÃ  Báº£o máº­t

### Táº¡o monitoring script
```bash
#!/bin/bash
# monitor.sh

if ! pgrep -f main.py > /dev/null; then
    echo "$(date): IP Monitor bot is down, restarting..."
    cd ~/ip-monitor-bot
    python3 main.py &
fi
```

ThÃªm vÃ o crontab:
```bash
crontab -e
# Kiá»ƒm tra má»—i 5 phÃºt
*/5 * * * * /path/to/monitor.sh
```

### Báº£o máº­t file .env
```bash
# Chá»‰ owner cÃ³ thá»ƒ Ä‘á»c/ghi
chmod 600 .env

# Kiá»ƒm tra quyá»n
ls -la .env
```

### Backup cáº¥u hÃ¬nh
```bash
# Táº¡o backup (khÃ´ng bao gá»“m sensitive data)
cp config.json config.json.backup

# Hoáº·c backup toÃ n bá»™ (cáº©n tháº­n vá»›i .env)
tar -czf ip-monitor-backup.tar.gz --exclude='.env' ~/ip-monitor-bot/
```

## ğŸš€ TÃ­nh nÄƒng má»›i

### Multiple Recipients Support
- âœ… **Telegram**: Gá»­i Ä‘áº¿n nhiá»u chat/group cÃ¹ng lÃºc
- âœ… **Discord**: Gá»­i Ä‘áº¿n nhiá»u server/channel cÃ¹ng lÃºc  
- âœ… **Environment Variables**: Cáº¥u hÃ¬nh qua .env file
- âœ… **Docker Support**: Cháº¡y trong container
- âœ… **Backward Compatibility**: TÆ°Æ¡ng thÃ­ch vá»›i config cÅ©

### VÃ­ dá»¥ cáº¥u hÃ¬nh Ä‘a kÃªnh

```bash
# .env file
NOTIFICATION_METHODS=telegram,discord

# Telegram: Gá»­i Ä‘áº¿n 3 chat khÃ¡c nhau
TELEGRAM_BOT_TOKEN=123456789:ABCDEF...
TELEGRAM_CHAT_IDS=123456789,987654321,-1001234567890

# Discord: Gá»­i Ä‘áº¿n 2 server khÃ¡c nhau
DISCORD_WEBHOOK_URLS=https://discord.com/api/webhooks/111/AAA,https://discord.com/api/webhooks/222/BBB
```

Bot sáº½ gá»­i thÃ´ng bÃ¡o Ä‘áº¿n táº¥t cáº£ 5 Ä‘Ã­ch (3 Telegram + 2 Discord) khi IP thay Ä‘á»•i!

## ğŸ“ˆ Performance

- **CPU usage**: ~0.1% khi idle
- **Memory usage**: ~15-25MB (vá»›i python-dotenv)
- **Network**: 1-2KB per check
- **Disk**: Log file tÄƒng ~1MB/thÃ¡ng
- **Scalability**: Há»— trá»£ unlimited chat IDs/webhooks

---

**â­ Náº¿u project há»¯u Ã­ch, hÃ£y star repository!**